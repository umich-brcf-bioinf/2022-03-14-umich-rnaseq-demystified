---
title: "Day 3 - Module 09 PCA Exercise"
author: "UM Bioinformatics Core"
date: "`r Sys.Date()`"
output:
        html_document:
            includes:
                in_header: header.html
            theme: paper
            toc: true
            toc_depth: 4
            toc_float: true
            number_sections: true
            fig_caption: true
            markdown: GFM
            code_download: true
---
<style type="text/css">
body{ /* Normal  */
      font-size: 14pt;
  }
pre {
  font-size: 12pt
}
code.r{
  font-size: 12pt;
}
</style>

<!--- Allow the page to be wider --->
<style>
    body .main-container {
        max-width: 1200px;
    }
</style>

<br>

## [Breakout Exercise 1]: - PCA plot for raw data

<br>


```{r Modules, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
library(DESeq2)
library(ggplot2)
library(tidyr)
library(dplyr)
library(matrixStats)
library(ggrepel)
library(pheatmap)
library(RColorBrewer)
load("rdata/RunningData.RData")
```


**20 Minutes**

<br>

It can be useful to visualize to visualize how our samples organize along with the expression pattern of individual genes. We will create a heatmap of the top most variable genes using the `pheatmap` function.

<br>

### Instructions:

<br>

- One group member should share their screen in the breakout room. If nobody volunteers, a helper may randomly select someone.
- The group members should discuss the exercise and work together to find a solution.
- After a solution is found, allow time for all members to complete the exercise.

<br>

- First, create a object named `topVarGenes`

> Hint: The commands we used to plot the normalized data were:
>

<details>
    <summary>*Click for solution*</summary>
```{r TestSampleHeatmap}
topVarGenes <- head(order(rowVars(assay(rld)), decreasing=TRUE), 50)
```
</details>

```{r GenerateLabels}
df <- as.data.frame(colData(dds)[,c("Gtype","Tx")])
```

```{r TestPheatmap}
pheatmap(assay(rld)[topVarGenes,], show_rownames=FALSE,
         annotation_col=df, scale = "row")
```



```{r PheatmapColor}
colors <- colorRampPalette( rev(brewer.pal(9, "Blues")) )(500)
pheatmap(assay(rld)[topVarGenes,], show_rownames=FALSE,
         annotation_col=df, scale = "row", color = colors)
```


Finally, to **output** the plot to file, use the `pdf()` function:
```{r ExerciseOutput}
pdf(file = paste0(plotPath, 'Top_heatmap_rlog_', Comparison, '.pdf'), onefile = TRUE)
plot(gp)
dev.off()
```

### Optional - Scree Plot example 

<details>
    <summary>*Click for solution*</summary>
     Solution
```{r Solution}
## Add solution 
```
    Solution
</details>


  
```{r WriteOut.RData, eval=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
#Hidden code block to write out data for knitting
save.image(file = "rdata/RunningData.RData")
```


